var routine = {
    "res": [{
        "idtimetable": 1,
        "frombit": "05:45:00",
        "fromdoranda": "6:50:00",
        "fromxavier": "7:00:00",
        "fromlalpur": "7:05:00",
        "typeofbus": "Staff",
        "typeofday": "Mon-Fri",
        "busno": "JH-01AY-1111",
        "isRunning": 1,
        "hasdeparted": 0
    }, {
        "idtimetable": 2,
        "frombit": "6:15:00",
        "fromdoranda": null,
        "fromxavier": "7:00:00",
        "fromlalpur": "7:05:00",
        "typeofbus": "Student",
        "typeofday": "Mon-Fri",
        "busno": "JH-01AY-1111",
        "isRunning": 1,
        "hasdeparted": 0
    }, {
        "idtimetable": 3,
        "frombit": "6:15:00",
        "fromdoranda": null,
        "fromxavier": "8:10:00",
        "fromlalpur": "8:15:00",
        "typeofbus": "Staff",
        "typeofday": "Mon-Fri",
        "busno": "JH-01AY-1111",
        "isRunning": 1,
        "hasdeparted": 0
    }, {
        "idtimetable": 4,
        "frombit": "6:50:00",
        "fromdoranda": "8:00:00",
        "fromxavier": null,
        "fromlalpur": null,
        "typeofbus": "Staff",
        "typeofday": "Mon-Fri",
        "busno": "JH-01AY-1111",
        "isRunning": 1,
        "hasdeparted": 0
    }, {
        "idtimetable": 5,
        "frombit": "7:30:00",
        "fromdoranda": "13:30:00",
        "fromxavier": "14:00:00",
        "fromlalpur": "14:05:00",
        "typeofbus": "Staff",
        "typeofday": "Mon-Fri",
        "busno": "JH-01AY-1111",
        "isRunning": 1,
        "hasdeparted": 0
    }, {
        "idtimetable": 6,
        "frombit": "8:10:00",
        "fromdoranda": null,
        "fromxavier": "9:30:00",
        "fromlalpur": "9:35:00",
        "typeofbus": "Staff",
        "typeofday": "Mon-Fri",
        "busno": "JH-01AY-1111",
        "isRunning": 1,
        "hasdeparted": 0
    }, {
        "idtimetable": 7,
        "frombit": "9:10:00",
        "fromdoranda": "12:15:00",
        "fromxavier": "13:00:00",
        "fromlalpur": "13:05:00",
        "typeofbus": "Staff",
        "typeofday": "Mon-Fri",
        "busno": "JH-01AY-1111",
        "isRunning": 1,
        "hasdeparted": 0
    }, {
        "idtimetable": 8,
        "frombit": "10:30:00",
        "fromdoranda": null,
        "fromxavier": null,
        "fromlalpur": null,
        "typeofbus": "Staff",
        "typeofday": "Mon-Fri",
        "busno": "JH-01AY-1111",
        "isRunning": 1,
        "hasdeparted": 0
    }, {
        "idtimetable": 9,
        "frombit": "11:00:00",
        "fromdoranda": null,
        "fromxavier": "12:00:00",
        "fromlalpur": "12:05:00",
        "typeofbus": "Student",
        "typeofday": "Mon-Fri",
        "busno": "JH-01AY-2222",
        "isRunning": 1,
        "hasdeparted": 0
    }, {
        "idtimetable": 10,
        "frombit": "13:10:00",
        "fromdoranda": null,
        "fromxavier": "15:30:00",
        "fromlalpur": "3:35:00",
        "typeofbus": "Student",
        "typeofday": "Mon-Fri",
        "busno": "JH-01AY-3333",
        "isRunning": 1,
        "hasdeparted": 0
    }, {
        "idtimetable": 11,
        "frombit": "14:30:00",
        "fromdoranda": null,
        "fromxavier": "16:15:00",
        "fromlalpur": "16:20:00",
        "typeofbus": "Staff",
        "typeofday": "Mon-Fri",
        "busno": "JH-01AY-1111",
        "isRunning": 1,
        "hasdeparted": 0
    }, {
        "idtimetable": 12,
        "frombit": "16:40:00",
        "fromdoranda": null,
        "fromxavier": "17:40:00",
        "fromlalpur": "17:45:00",
        "typeofbus": "Student",
        "typeofday": "Mon-Fri",
        "busno": "JH-01AY-4444",
        "isRunning": 1,
        "hasdeparted": 0
    }, {
        "idtimetable": 13,
        "frombit": "17:30:00",
        "fromdoranda": null,
        "fromxavier": "19:00:00",
        "fromlalpur": "19:05:00",
        "typeofbus": "Student",
        "typeofday": "Mon-Fri",
        "busno": "JH-01AY-5555",
        "isRunning": 1,
        "hasdeparted": 0
    }, {
        "idtimetable": 14,
        "frombit": "17:40:00",
        "fromdoranda": "18:40:00",
        "fromxavier": null,
        "fromlalpur": "20:10:00",
        "typeofbus": "Staff",
        "typeofday": "Mon-Fri",
        "busno": "JH-01AY-1111",
        "isRunning": 1,
        "hasdeparted": 0
    }, {
        "idtimetable": 15,
        "frombit": "17:40:00",
        "fromdoranda": null,
        "fromxavier": "18:30:00",
        "fromlalpur": "18:35:00",
        "typeofbus": "Staff",
        "typeofday": "Mon-Fri",
        "busno": "JH-01AY-1111",
        "isRunning": 1,
        "hasdeparted": 0
    }, {
        "idtimetable": 16,
        "frombit": "5:45:00",
        "fromdoranda": "6:50:00",
        "fromxavier": "7:00:00",
        "fromlalpur": "7:05:00",
        "typeofbus": "Staff",
        "typeofday": "Sat",
        "busno": "JH-01AY-1111",
        "isRunning": 1,
        "hasdeparted": 0
    }, {
        "idtimetable": 17,
        "frombit": "6:15:00",
        "fromdoranda": null,
        "fromxavier": "8:10:00",
        "fromlalpur": "8:15:00",
        "typeofbus": "Staff",
        "typeofday": "Sat",
        "busno": "JH-01AY-1111",
        "isRunning": 1,
        "hasdeparted": 0
    }, {
        "idtimetable": 18,
        "frombit": "6:50:00",
        "fromdoranda": "8:00:00",
        "fromxavier": null,
        "fromlalpur": null,
        "typeofbus": "Staff",
        "typeofday": "Sat",
        "busno": "JH-01AY-1111",
        "isRunning": 1,
        "hasdeparted": 0
    }, {
        "idtimetable": 19,
        "frombit": "7:30:00",
        "fromdoranda": "13:30:00",
        "fromxavier": "14:00:00",
        "fromlalpur": "14:05:00",
        "typeofbus": "Staff",
        "typeofday": "Sat",
        "busno": "JH-01AY-1111",
        "isRunning": 1,
        "hasdeparted": 0
    }, {
        "idtimetable": 20,
        "frombit": "8:10:00",
        "fromdoranda": null,
        "fromxavier": "9:30:00",
        "fromlalpur": "9:35:00",
        "typeofbus": "Staff",
        "typeofday": "Sat",
        "busno": "JH-01AY-1111",
        "isRunning": 1,
        "hasdeparted": 0
    }, {
        "idtimetable": 21,
        "frombit": "8:30:00",
        "fromdoranda": null,
        "fromxavier": "10:00:00",
        "fromlalpur": "10:05:00",
        "typeofbus": "Student",
        "typeofday": "Sat",
        "busno": "JH-01AY-6666",
        "isRunning": 0,
        "hasdeparted": 1
    }, {
        "idtimetable": 22,
        "frombit": "9:10:00",
        "fromdoranda": "12:15:00",
        "fromxavier": "13:00:00",
        "fromlalpur": "13:05:00",
        "typeofbus": "Staff",
        "typeofday": "Sat",
        "busno": "JH-01AY-1111",
        "isRunning": 1,
        "hasdeparted": 0
    }, {
        "idtimetable": 23,
        "frombit": "10:30:00",
        "fromdoranda": null,
        "fromxavier": null,
        "fromlalpur": null,
        "typeofbus": "Staff",
        "typeofday": "Sat",
        "busno": "JH-01AY-1111",
        "isRunning": 1,
        "hasdeparted": 0
    }, {
        "idtimetable": 24,
        "frombit": "11:00:00",
        "fromdoranda": null,
        "fromxavier": "12:00:00",
        "fromlalpur": "12:05:00",
        "typeofbus": "Student",
        "typeofday": "Sat",
        "busno": "JH-01AY-7777",
        "isRunning": 1,
        "hasdeparted": 0
    }, {
        "idtimetable": 25,
        "frombit": "13:00:00",
        "fromdoranda": null,
        "fromxavier": "15:15:00",
        "fromlalpur": "15:20:00",
        "typeofbus": "Student",
        "typeofday": "Sat",
        "busno": "JH-01AY-9999",
        "isRunning": 1,
        "hasdeparted": 1
    }, {
        "idtimetable": 26,
        "frombit": "13:00:00",
        "fromdoranda": null,
        "fromxavier": "15:30:00",
        "fromlalpur": "15:35:00",
        "typeofbus": "Student",
        "typeofday": "Sat",
        "busno": "JH-01AY-2222",
        "isRunning": 1,
        "hasdeparted": 1
    }, {
        "idtimetable": 27,
        "frombit": "14:30:00",
        "fromdoranda": null,
        "fromxavier": "16:15:00",
        "fromlalpur": "16:20:00",
        "typeofbus": "Staff",
        "typeofday": "Sat",
        "busno": "JH-01AY-1111",
        "isRunning": 1,
        "hasdeparted": 0
    }, {
        "idtimetable": 28,
        "frombit": "16:10:00",
        "fromdoranda": null,
        "fromxavier": "17:40:00",
        "fromlalpur": "17:45:00",
        "typeofbus": "Student",
        "typeofday": "Sat",
        "busno": "JH-01AY-3333",
        "isRunning": 1,
        "hasdeparted": 0
    }, {
        "idtimetable": 29,
        "frombit": "17:10:00",
        "fromdoranda": null,
        "fromxavier": null,
        "fromlalpur": "8:10:00",
        "typeofbus": "Staff",
        "typeofday": "Sat",
        "busno": "JH-01AY-1111",
        "isRunning": 1,
        "hasdeparted": 0
    }, {
        "idtimetable": 30,
        "frombit": "18:10:00",
        "fromdoranda": null,
        "fromxavier": "19:00:00",
        "fromlalpur": "19:05:00",
        "typeofbus": "Student",
        "typeofday": "Sat",
        "busno": "JH-01AY-4444",
        "isRunning": 1,
        "hasdeparted": 0
    }, {
        "idtimetable": 31,
        "frombit": "8:00:00",
        "fromdoranda": null,
        "fromxavier": "9:30:00",
        "fromlalpur": "9:35:00",
        "typeofbus": "Staff",
        "typeofday": "Sun",
        "busno": "JH-01AY-1111",
        "isRunning": 1,
        "hasdeparted": 0
    }, {
        "idtimetable": 32,
        "frombit": "8:30:00",
        "fromdoranda": null,
        "fromxavier": "10:00:00",
        "fromlalpur": "10:05:00",
        "typeofbus": "Student",
        "typeofday": "Sun",
        "busno": "JH-01AY-1111",
        "isRunning": 1,
        "hasdeparted": 0
    }, {
        "idtimetable": 33,
        "frombit": "10:30:00",
        "fromdoranda": null,
        "fromxavier": "13:30:00",
        "fromlalpur": "13:35:00",
        "typeofbus": "Staff",
        "typeofday": "Sun",
        "busno": "JH-01AY-1111",
        "isRunning": 1,
        "hasdeparted": 0
    }, {
        "idtimetable": 34,
        "frombit": "11:00:00",
        "fromdoranda": null,
        "fromxavier": "12:00:00",
        "fromlalpur": "12:05:00",
        "typeofbus": "Student",
        "typeofday": "Sun",
        "busno": "JH-01AY-2222",
        "isRunning": 1,
        "hasdeparted": 0
    }, {
        "idtimetable": 35,
        "frombit": "11:00:00",
        "fromdoranda": null,
        "fromxavier": "12:00:00",
        "fromlalpur": "12:05:00",
        "typeofbus": "Student",
        "typeofday": "Sun",
        "busno": "JH-01AY-3333",
        "isRunning": 1,
        "hasdeparted": 0
    }, {
        "idtimetable": 36,
        "frombit": "13:00:00",
        "fromdoranda": null,
        "fromxavier": "15:15:00",
        "fromlalpur": "15:20:00",
        "typeofbus": "Student",
        "typeofday": "Sun",
        "busno": "JH-01AY-1111",
        "isRunning": 1,
        "hasdeparted": 0
    }, {
        "idtimetable": 37,
        "frombit": "13:00:00",
        "fromdoranda": null,
        "fromxavier": "15:30:00",
        "fromlalpur": "15:35:00",
        "typeofbus": "Student",
        "typeofday": "Sun",
        "busno": "JH-01AY-4444",
        "isRunning": 1,
        "hasdeparted": 0
    }, {
        "idtimetable": 38,
        "frombit": "15:00:00",
        "fromdoranda": null,
        "fromxavier": "4:00:00",
        "fromlalpur": "8:10:00",
        "typeofbus": "Staff",
        "typeofday": "Sun",
        "busno": "JH-01AY-1111",
        "isRunning": 1,
        "hasdeparted": 0
    }, {
        "idtimetable": 39,
        "frombit": "16:10:00",
        "fromdoranda": null,
        "fromxavier": "17:40:00",
        "fromlalpur": "17:45:00",
        "typeofbus": "Student",
        "typeofday": "Sun",
        "busno": "JH-01AY-4444",
        "isRunning": 1,
        "hasdeparted": 0
    }, {
        "idtimetable": 40,
        "frombit": "18:10:00",
        "fromdoranda": null,
        "fromxavier": "19:00:00",
        "fromlalpur": "19:05:00",
        "typeofbus": "Student",
        "typeofday": "Sun",
        "busno": "JH-01AY-4444",
        "isRunning": 1,
        "hasdeparted": 0
    }]
}
const listOfHolidays = ["Tue Jan 01 2019", "Tue Jan 15 2019", "Sat Jan 26 2019", "Sun Feb 10 2019", "Mon Mar 04 2019", "Thu Mar 21 2019", "Mon Apr 08 2019", "Sat Apr 13 2019", "Sun Apr 14 2019", "Wed Apr 17 2019", "Fri Apr 19 2019", "Sat May 18 2019", "Wed Jun 05 2019", "Thu Jul 04 2019", "Mon Aug 12 2019", "Thu Aug 15 2019", "Fri Aug 23 2019", "Mon Sep 09 2019", "Tue Sep 10 2019", "Tue Sep 17 2019", "Wed Oct 02 2019", "Sat Oct 05 2019", "Sun Oct 06 2019", "Mon Oct 07 2019", "Tue Oct 08 2019", "Sun Oct 27 2019", "Sat Nov 02 2019", "Sun Nov 10 2019", "Tue Nov 12 2019", "Fri Nov 15 2019", "Wed Dec 25 2019"];
const mon = "Mon-Fri";
const sun = "Sun";
const sat = "sat";
const week = [sun,mon,mon,mon,mon,mon,sat];
var globalvariable = null;


var app = angular.module('myApp',[]);
app.controller('myCtrl',function($scope,$http){
    globalvariable = $scope;
    // let config = {method:"GET",url:"http://127.0.0.1:5000/routine"};
    // $http(config).then(successFunc,errorFunc);
    $scope.RoutineArr = routine.res;
    // debugger;
    $scope.currDate = new Date();
    $scope.currTime = $scope.currDate;
    $scope.currTime.setSeconds(0,0);

    // setProperTime($scope.RoutineArr);
    const BIT = "BIT";
    const Ranchi = "Ranchi"
    $scope.travel = {source:BIT,destination:Ranchi};









    // function successFunc(response){
    //     console.log("Success response = ");
    //     $scope.RoutineArr = response.data.res;
    //     debugger;
    //     console.log(response);
    // }
    // function errorFunc(response){
    //     console.log("Error response = ");
    //     debugger;
    //     console.log(response);
    // }
    
    function fetchRecord(weekday,source){
        let arr = jQuery.grep(routine.res,function(element,index){return element.typeofday=== weekday;});
    }
    
    $scope.changeSource = function(ev){

        if($scope.travel.source==BIT)
            $scope.travel.destination = Ranchi
        if($scope.travel.source==Ranchi)
            $scope.travel.destination = BIT
    }

    $scope.changeDestination = function(){
        if($scope.travel.destination==BIT)
            $scope.travel.source = Ranchi
        if($scope.travel.destination==Ranchi)
            $scope.travel.source = BIT
    }

    $scope.setTime = function(){
        $scope.currTime.setMinutes(00,00,00)
    }

    $scope.searchBuses = function(){
        console.log("click");
        let searchform = document.forms.searchbusform;
        let config = {
            method:"POST",url:"/today",
            headers:{"Content-Type":"application/json"},
            data:{
                "source": searchform.source.value,
                "destination":searchform.destination.value,
                "curdate":searchform.curdate.value,
                "curtime":searchform.curtime.value,
            }
        }
        $http(config).then(function(response){
            console.log("Success")
            // debugger;
            $scope.RoutineArr = response.data;
            setProperTime($scope.RoutineArr);

        },function(response){
            console.log("Error");
            // debugger;
        })
    }
    $scope.validatelogin = function(){
        let config = {
            method:"POST",
            url:"/auth",
            headers:{"Content-Type":"application/json"},
            data:{
                "username":$scope.username,
                "password":$scope.password
            }
        };
        $http(config).then(succLog,errorLog);

    }
    function succLog(response){
        console.log("Login")
    }
    function errorLog(response){
        console.log("failed Logn=in")
    }
});


function setProperTime(arr){//This FUnction is to Feed Data in HTML Input type= Date inn proper format
    for(i in arr){
        let hours,minutes,seconds=null;
        if(arr[i].departure!=null){
            [hours,minutes,seconds] = arr[i].departure.split(':');
            arr[i].departure = new Date(1970,0,1,hours,minutes,seconds);
        }


    }
}

function getWeekDay(idofDatePicker){//Get weekDay from Current Date and Holiday
    let dtVal = document.getElementById(idofDatePicker).value;
    if(listOfHolidays.indexOf(dtVal)!= -1){
        return "Sun";
    }
    dt = new Date(dtVal);

    
	let week = ["Sun","Mon-Fri","Mon-Fri","Mon-Fri","Mon-Fri","Mon-Fri","Sat"];
	return week[dt.getDay()];
}
function getDate(){
    var today = new Date();

    document.getElementById("date").value = today.getFullYear() + '-' + ('0' + (today.getMonth() + 1)).slice(-2) + '-' + ('0' + today.getDate()).slice(-2);


}
